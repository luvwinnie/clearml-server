_description: """This service provides OIDC (OpenID Connect) authentication endpoints for SSO login."""

_default {
    internal: false
    authorize: null
    allow_roles: ["*"]
}

authorize {
    authorize: null
    "2.1" {
        description: """Initiate OIDC authorization flow. Redirects to the identity provider."""
        request {
            type: object
            properties {
                provider {
                    description: "OIDC provider name"
                    type: string
                }
                redirect_uri {
                    description: "Optional redirect URI override"
                    type: string
                }
            }
            required: ["provider"]
            additionalProperties: false
        }
        response {
            type: object
            properties {
                url {
                    description: "Authorization URL to redirect to"
                    type: string
                }
            }
        }
    }
}

callback {
    authorize: null
    "2.1" {
        description: """Handle OIDC callback from identity provider. Exchanges code for tokens and creates/updates user."""
        request {
            type: object
            properties {
                provider {
                    description: "OIDC provider name"
                    type: string
                }
                code {
                    description: "Authorization code from identity provider"
                    type: string
                }
                state {
                    description: "State parameter for CSRF protection"
                    type: string
                }
            }
            additionalProperties: true
        }
        response {
            type: object
            properties {
                user {
                    description: "User ID"
                    type: string
                }
                token {
                    description: "Authentication token"
                    type: string
                }
            }
        }
    }
}
